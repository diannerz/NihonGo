<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - NihonGo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Yu Gothic', sans-serif; display: flex; height: 100vh; }

    .left { flex: 1; background-color: #91a3ad; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .left img { width: 300px; margin-bottom: 40px; }
    .left p { font-size: 24px; color: #f5f5f5; font-weight: 300; letter-spacing: 2px; }

    .right { flex: 1; background: linear-gradient(135deg, #2b5a68 0%, #1f4a56 100%); color: white; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:40px; }
    .login-container { width:100%; max-width:400px; }

    .right h1 { font-size: 56px; margin-bottom: 30px; font-weight: 300; letter-spacing: 3px; text-align:center; }
    .right h1 span { color: #ff8080; font-weight:700; }
    .signup-link { text-align:center; margin-bottom: 18px; font-size:16px; color:#ffffff; }
    .signup-link a { color:#ffffff; text-decoration:underline; font-weight:500; }

    form { display:flex; flex-direction:column; width:100%; }
    .form-group { margin-bottom: 18px; }
    label { display:block; font-size:16px; margin-bottom:8px; font-weight:500; color:#ffffff; }
    input[type="text"], input[type="password"] { width:100%; padding:14px 16px; border:none; border-radius:6px; font-size:15px; background:#f0f0f0; color:#333; font-family:inherit; }
    input::placeholder { color:#999; }
    input:focus { outline:none; background:#fff; box-shadow: 0 0 0 3px rgba(255,128,128,0.1); }

    .form-options { display:flex; justify-content:space-between; align-items:center; margin: 12px 0 20px; font-size:14px; }
    .checkbox-wrapper { display:flex; align-items:center; gap:8px; color:#fff; }
    input[type="checkbox"] { width:18px; height:18px; cursor:pointer; accent-color:#ff8080; }
    .forgot-password { color:#fff; text-decoration:underline; font-size:14px; cursor:pointer; }

    button { width:100%; padding:14px; background: linear-gradient(135deg, #4f6d75 0%, #3d5560 100%); border:none; color:white; font-size:18px; font-weight:500; border-radius:6px; cursor:pointer; letter-spacing:2px; transition:all .25s ease; }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,0.15); }

    .error { margin-top:12px; color:#ffcccc; font-size:14px; display:none; text-align:center; }
    .error.show { display:block; }

    .hint { margin-top:14px; font-size:13px; color:#e7f3f4; text-align:center; }
    .hint a { color:#fff; text-decoration:underline; }
  </style>
</head>
<body>
  <div class="left">
    <img src="images/LOGO.png" alt="Logo">
    <p>one kana at a time</p>
  </div>

  <div class="right">
    <div class="login-container">
      <h1>Nihon<span>Go</span></h1>

      <p class="signup-link">Don't have an account yet? <a href="signup.html">Sign Up</a></p>

      <!-- form uses JS validation (no "action" attribute) -->
      <form id="loginForm" autocomplete="off" novalidate>
        <div class="form-group">
          <label for="username">Username</label>
          <input id="username" name="username" type="text" placeholder="username" required>
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input id="password" name="password" type="password" placeholder="password" required>
        </div>

        <div class="form-options">
          <div class="checkbox-wrapper">
            <input id="keep-logged" type="checkbox" name="keep-logged">
            <label for="keep-logged" style="color:#fff; font-weight:400; cursor:pointer;">Keep me logged in</label>
          </div>
          <a class="forgot-password" href="#">Forgot Password?</a>
        </div>

        <button id="loginBtn" type="submit">Login</button>

        <div id="errorMessage" class="error">Incorrect username or password. <span style="display:block; margin-top:6px;"><a href="signup.html">Create an account</a> if you don't have one.</span></div>
        <div id="noAccount" class="hint" style="display:none;">No account found. <a href="signup.html">Sign up</a> to create one.</div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      // If already logged in â€” redirect to dashboard
      if (localStorage.getItem('loggedInUser') || sessionStorage.getItem('loggedInUser')) {
        window.location.href = '/xampp/NihonGo/dashboard.html';
        return;
      }

      const loginForm = document.getElementById('loginForm');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const keepLogged = document.getElementById('keep-logged');
      const errorMessage = document.getElementById('errorMessage');
      const noAccount = document.getElementById('noAccount');

      // On submit, check saved credentials
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        errorMessage.classList.remove('show');
        noAccount.style.display = 'none';

        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();

        if (!username || !password) {
          errorMessage.textContent = 'Please enter both username and password.';
          errorMessage.classList.add('show');
          return;
        }

        const storedRaw = localStorage.getItem('registeredUser');
        if (!storedRaw) {
          // no user registered
          noAccount.style.display = 'block';
          return;
        }

        try {
          const stored = JSON.parse(storedRaw);
          // stored object shape: { username, email, password } from signup page
          if (stored.username === username && stored.password === password) {
            // success: set logged in state
            // use localStorage so dashboard logic relying on localStorage still works.
            if (keepLogged.checked) {
              localStorage.setItem('loggedInUser', username);
              sessionStorage.setItem('loggedInUser', username);
            } else {
              // still set localStorage to simplify your current dashboard checks,
              // and set sessionStorage as well (dashboard snippet below checks both).
              localStorage.setItem('loggedInUser', username);
              sessionStorage.setItem('loggedInUser', username);
            }
            // redirect to dashboard
            window.location.href = '/xampp/NihonGo/login.html';
          } else {
            // wrong credentials
            errorMessage.innerHTML = 'Incorrect username or password. <br><span style="display:block; margin-top:6px;"><a href="signup.html">Create an account</a> if you don\'t have one.</span>';
            errorMessage.classList.add('show');
          }
        } catch (err) {
          console.error('Error parsing stored user', err);
          errorMessage.textContent = 'Internal error. Please try again later.';
          errorMessage.classList.add('show');
        }
      });
    })();
  </script>
</body>
</html>
